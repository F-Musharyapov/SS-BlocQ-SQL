//Task 57
//Для классов, имеющих потери в виде потопленных кораблей и не менее 3 кораблей в базе данных,
//вывести имя класса и число потопленных кораблей.

SELECT Classes.class, SUM(table2.sunked) as sunked
FROM Classes LEFT JOIN (
    SELECT table1.name AS name, table1.class AS class,
    CASE WHEN Outcomes.result = 'sunk' THEN 1 ELSE 0 END AS sunked
    FROM (
        SELECT name, class
        FROM Ships
        UNION
        SELECT ship, ship
        FROM Outcomes) AS table1
    LEFT JOIN Outcomes ON table1.name = Outcomes.ship) table2 ON table2.class = Classes.class
GROUP BY Classes.class
HAVING COUNT(DISTINCT table2.name)>=3
AND SUM(table2.sunked)>0